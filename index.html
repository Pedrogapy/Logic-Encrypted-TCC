<!DOCTYPE html>
<html lang="pt-br">
<head>
  <script>
  const iframe = document.getElementById('game-iframe-container');
  const stubCode = `(function(){const s=(n)=>(...a)=>{console.log('[stub:'+n+']',a);
  if((n.includes('saveProgress')||n.includes('setLevel'))&&a.length){const l=parseInt(a[0],10);
  if(!isNaN(l)){try{parent.location.hash='#save_level_'+l;}catch(_){}}}return null;};
  ['firebase_init','firebase2_init','firebase_login','firebase2_login','firebase_logout','firebase2_logout',
  'firebase_saveProgress','firebase2_saveProgress','firebase_getProgress','firebase2_getProgress',
  'firebase_setLevel','firebase2_setLevel','firebase_reportEvent','firebase2_reportEvent']
  .forEach(f=>{if(typeof window[f]!=='function')window[f]=s(f);});})();`;

  iframe.addEventListener('load', () => {
    try {
      const cw = iframe.contentWindow;
      if (cw && typeof cw.firebase_init !== 'function') {
        cw.eval(stubCode);
        console.log('Stub injetado no iframe (fallback).');
      }
    } catch (e) {
      console.warn('Falha ao injetar stub no iframe:', e);
    }
  });
  </script>

  <!-- tem que ser o PRIMEIRO script do head -->
  <script src="firebase-api.js?v=2"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Logic-Encrypted</title>

  <link rel="stylesheet" href="style.css"/>

  <!-- Seu firebase-init.js já exporta { auth, db } -->
  <script type="module" src="firebase-init.js"></script>
  <script type="module" src="script.js"></script>
</head>
<body>
  <header>
    <h1>Logic-Encrypted</h1>
    <p class="subtitle">Jogo educacional para lógica de programação</p>
  </header>

  <section class="status">
    <p><strong>Status Firebase:</strong> <span id="status-firebase">Verificando...</span></p>
  </section>

  <section id="area-nao-logada">
    <div class="card">
      <h2>Criar conta</h2>
      <label>E-mail</label>
      <input id="campo-email" type="email" placeholder="seu@email.com"/>
      <label>Senha</label>
      <input id="campo-senha" type="password" placeholder="********"/>
      <button id="botao-cadastrar">Cadastrar</button>
      <p id="mensagem-erro" class="error"></p>
    </div>

    <div class="card">
      <h2>Entrar</h2>
      <label>E-mail</label>
      <input id="login-email" type="email" placeholder="seu@email.com"/>
      <label>Senha</label>
      <input id="login-senha" type="password" placeholder="********"/>
      <button id="botao-login">Entrar</button>
      <p id="mensagem-login-erro" class="error"></p>
    </div>
  </section>

  <section id="area-logada" style="display:none;">
    <div class="row">
      <h2>Bem-vindo, <span id="email-usuario"></span></h2>
      <button id="botao-sair" class="secondary">Sair</button>
    </div>
    <hr/>
    <h3>Jogo</h3>
    <p>Ao concluir uma fase, seu progresso é salvo automaticamente.</p>
    <iframe id="game-iframe-container" title="Logic-Encrypted (HTML5)" loading="lazy"></iframe>
  </section>
</body>
</html>
